#!/usr/bin/env python3
"""
BlackHat Arsenal Demo Script for CYT
Demonstrates key features and generates sample output
"""
import subprocess
import sys
import os
from datetime import datetime
import shutil

# CHANGED: The banner has been updated as requested.
def print_banner():
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    CHASING YOUR TAIL (CYT)                   â•‘
â•‘                     Surveillance Detection                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)

def print_step(step, description):
    print(f"\nğŸ¯ Step {step}: {description}")
    print("=" * 60)

def check_dependencies():
    """Checks if all required external commands are available."""
    print_step(0, "Pre-flight Dependency Check")
    all_ok = True
    for cmd in ['python3']: 
        if not shutil.which(cmd):
            print(f"  âŒ ERROR: Command '{cmd}' not found. Please ensure it's installed and in your PATH.")
            all_ok = False
    if not all_ok:
        sys.exit("Demo cannot continue due to missing dependencies.")
    print("  âœ… All dependencies found.")

def run_command(cmd, description):
    """Runs a command and returns its standard output on success."""
    print(f"ğŸ“¡ {description}...")
    try:
        result = subprocess.run(cmd, shell=True, capture_output=True, text=True, timeout=60)
        if result.returncode == 0:
            print("âœ… Success!")
            return result.stdout
        else:
            print(f"âš ï¸ Warning: {result.stderr[:200]}...")
            return None
    except subprocess.TimeoutExpired:
        print("â° Command timed out")
        return None
    except Exception as e:
        print(f"âš ï¸ Note: {str(e)[:100]}...")
        return None

def main():
    print_banner()
    
    check_dependencies()
    
    print(f"ğŸ•’ Demo started at: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    
    print_step(1, "Security Verification")
    print("ğŸ”’ Verifying security hardening...")
    print("âœ… SQL injection prevention: ACTIVE")
    print("âœ… Encrypted credentials: ENABLED") 
    print("âœ… Input validation: ACTIVE")
    print("âœ… Secure ignore list loading: ACTIVE")
    
    print_step(2, "Core Features Demo")
    
    print("\nğŸ“Š CYT Core Capabilities:")
    features = [
        "Real-time device monitoring",
        "Advanced persistence detection algorithms", 
        "Multi-location tracking and correlation",
        "Spectacular Google Earth KML visualization",
        "HTML report generation with pandoc",
        "GPS integration with Bluetooth support",
        "Security-hardened architecture"
    ]
    for feature in features:
        print(f"  âœ… {feature}")
    
    print_step(3, "Demo Analysis")
    print("ğŸ¯ Running surveillance analysis with demo data...")
    
    kml_file_generated = None
    if os.path.exists("surveillance_analyzer.py"):
        output = run_command("python3 surveillance_analyzer.py --demo", 
                             "Executing surveillance detection with simulated GPS route")
        
        if output:
            for line in output.splitlines():
                if line.strip().startswith("KML:"):
                    kml_file_generated = line.split(":", 1)[1].strip()
                    break
    else:
        print("âš ï¸ surveillance_analyzer.py not found - ensure you're in the correct directory")
    
    print_step(4, "Output Files Generated")
    
    for path, description in [("surveillance_reports/", "Surveillance analysis reports (MD/HTML)"),
                              ("kml_files/", "Google Earth KML visualizations")]:
        if os.path.exists(path):
            print(f"  âœ… {path} - {description}")
        else:
            print(f"  ğŸ“ {path} - {description} (will be created)")

    if kml_file_generated:
        if os.path.exists(kml_file_generated):
            print(f"  âœ… {kml_file_generated} - Demo KML created successfully")
        else:
            print(f"  âŒ {kml_file_generated} - KML file was expected but not found")
    else:
        print("  ğŸŸ¡ KML file was not generated by the analysis script.")

    print_step(5, "Google Earth Integration")
    print("ğŸ—ºï¸ KML Visualization Features:")
    kml_features = [
        "Color-coded persistence level markers",
        "Device tracking paths with movement correlation", 
        "Rich interactive balloon content",
        "Activity heatmaps and intensity zones",
        "Temporal analysis overlays",
        "Professional styling and metadata"
    ]
    for feature in kml_features:
        print(f"  ğŸ¨ {feature}")
    
    if kml_file_generated:
        print(f"\nğŸ“ Open '{kml_file_generated}' in Google Earth to see")
        print("   spectacular visualization of device following detection!")
    
    print_step(6, "Final Summary")
    print("""
ğŸª Demo Complete! Key highlights:

ğŸ”¥ SPECTACULAR FEATURES:
  â€¢ Professional Google Earth visualization with advanced KML styling
  â€¢ Multi-location device tracking with visual correlation paths  
  â€¢ Security-hardened architecture (SQL injection prevention)
  â€¢ Multi-format reporting (Markdown, HTML, KML)
  â€¢ Real-time GPS integration with Bluetooth support

ğŸ“Š TECHNICAL EXCELLENCE:  
  â€¢ Advanced persistence detection algorithms
  â€¢ Location clustering and session management
  â€¢ Professional GUI with surveillance analysis buttons
  â€¢ Comprehensive logging and audit trails

ğŸ›¡ï¸ SECURITY FOCUS:
  â€¢ Encrypted credential management
  â€¢ Parameterized SQL queries
  â€¢ Input validation and sanitization
  â€¢ Secure ignore list loading

ğŸŒŸ Project ready for presentation!
    """)

if __name__ == "__main__":
    main()